<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Provides functions for working with tensors (vectors, matrices, 
    or multidimensional arrays) as named hierarchical data structures. ">
<title>TidyTensor • tidytensor</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="deps/bs3compat-0.2.5.1/tabs.js"></script><script src="deps/bs3compat-0.2.5.1/bs3compat.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<link href="syntax-highlighting.css" rel="stylesheet">
<script src="pkgdown.js"></script><link href="extra.css" rel="stylesheet">
<script src="extra.js"></script><meta property="og:title" content="TidyTensor">
<meta property="og:description" content="Provides functions for working with tensors (vectors, matrices, 
    or multidimensional arrays) as named hierarchical data structures. ">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc" data-headroom>
    

      <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    <a class="navbar-brand mb-0 h1" href="index.html">tidytensor</a>

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <button type="button" id="version-badge" class="badge badge-default d-none d-lg-block" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Released version">0.9.0</button>

    <div id="navbar" class="collapse navbar-collapse">
      <ul class="navbar-nav mr-auto ml-3">
<li class="nav-item">
  <a class="nav-link" href="articles/tidytensor.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control mr-sm-2" aria-label="Search" name="search-input" data-search-index="/search.json" id="search-input" placeholder="Search..." autocomplete="off">
</form>

      <ul class="navbar-nav ml-1"></ul>
</div>
  </div>
</nav><div class="container template-home">
<div class="row">
  <div class="contents col-md-9">


<p><br><img src="reference/figures/tidytensor_transparent.png" height="200px/"></p>
<p>TidyTensor is an R package for inspecting and manipulating tensors (multidimensional arrays). It provides an improved <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code> function for summarizing structure, named tensors, conversion to data frames, and high-level manipulation functions. Designed to complement the excellent <code>keras</code> package, functionality is layered on top of base R types.</p>
<p>TidyTensor was inspired by a workshop I taught in deep learning with R, and a desire to explain and explore tensors in a more intuitive way.</p>
<ul>
<li><a href="#installation">Installation</a></li>
<li><a href="#background">Background</a></li>
<li><a href="#printing">Printing</a></li>
<li><a href="#named-ranks">Named Ranks</a></li>
<li><a href="#converting-to-dataframe-and-plotting">Converting to data.frame and plotting</a></li>
<li>
<a href="#manipulation">Manipulation</a>
<ul>
<li><a href="#c-and-bind"><code>c()</code> and <code>bind()</code></a></li>
<li><a href="#partition-and-aslist"><code>partition()</code> and <code>as.list()</code></a></li>
<li><a href="#shuffle-and-tt_apply"><code>shuffle()</code> and <code>tt_apply()</code></a></li>
</ul>
</li>
<li><a href="#future-work">Future Work</a></li>
</ul>
<p><br><br></p>
<div id="installation" class="section level3">
<h3 class="hasAnchor">
<a href="#installation" class="anchor" aria-hidden="true"></a>Installation</h3>
<p>A simple <code>devtools::install_github("oneilsh/tidytensor")</code> will do it. If you don’t have <code>devtools</code>, grab it with <code>install.packages("devtools")</code>.</p>
</div>
<div id="changelog" class="section level3">
<h3 class="hasAnchor">
<a href="#changelog" class="anchor" aria-hidden="true"></a>Changelog</h3>
<ul>
<li>v0.9.0: refactor <code>bottom</code> paramter of <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code> to <code>base_rank</code>
</li>
<li>v0.8.2: minor bugfixes, new combine_ranks() function</li>
<li>v0.8.1: add [] and [] &lt;- functionality</li>
<li>v0.8: first version on github</li>
</ul>
</div>
<div id="background" class="section level3">
<h3 class="hasAnchor">
<a href="#background" class="anchor" aria-hidden="true"></a>Background</h3>
<p>R natively supports <em>tensors</em> as one of vectors (1d arrays, or rank-1 tensors), matrices (2d arrays, or rank-2 tensors), or higher-dimensional arrays. Further, these support <code><a href="https://rdrr.io/r/base/names.html" class="external-link">names()</a></code>, allowing for indexing of elements by index and/or name.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">t1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.4</span>, <span class="fl">2.5</span>, <span class="fl">0.5</span>, <span class="fl">1.3</span><span class="op">)</span>
<span class="va">t1</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>
<span class="co"># [1] 0.5</span>

<span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">t1</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"d"</span><span class="op">)</span>
<span class="va">t1</span><span class="op">[</span><span class="st">"c"</span><span class="op">]</span>
<span class="co">#   c </span>
<span class="co"># 0.5 </span></code></pre></div>
<p>Matrices:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">t2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, nrow <span class="op">=</span> <span class="fl">2</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
<span class="va">t2</span></code></pre></div>
<pre><code>#      [,1] [,2] [,3]
# [1,]    1    3    5
# [2,]    2    4    6</code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">t2</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span></code></pre></div>
<pre><code># [1] 3</code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/dimnames.html" class="external-link">dimnames</a></span><span class="op">(</span><span class="va">t2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"row1"</span>, <span class="st">"row2"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"col1"</span>, <span class="st">"col2"</span>, <span class="st">"col3"</span><span class="op">)</span><span class="op">)</span>
<span class="va">t2</span></code></pre></div>
<pre><code>#      col1 col2 col3
# row1    1    3    5
# row2    2    4    6</code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">t2</span><span class="op">[</span><span class="st">"row1"</span>, <span class="st">"col2"</span><span class="op">]</span></code></pre></div>
<pre><code># [1] 3</code></pre>
<p>Higher-rank arrays can be created with e.g. <code>array(1:(3*6*6), dim = c(3, 6, 6))</code> to create a 3x6x6 structure–these also accept optional <code><a href="https://rdrr.io/r/base/dimnames.html" class="external-link">dimnames()</a></code>. The <em>shape</em> of a tensor is the vector returned by <code><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim()</a></code>, here <code>c(3, 6, 6)</code>. To stay with convention we use ‘rank’ of a tensor rather than ‘dimension’ of a tensor to avoid confusion in situations like 3d-points being stored in a rank-1 tensor of shape (3).</p>
<p>TidyTensor levereges the fact that tensors usually represent hierarchical “set of” relationships. For example, a 28x28 grayscale image may be encoded as a rank-2, shape (28, 28) tensor; an RBG color image of the same size would be represented with a rank-3 (3, 28, 28) tensor in a “channels first” representation. On the other hand, we might start with a pixel, represented as a rank-1 shape (3) tensor, and a color image as a 28x28 grid of them with shape (28, 28, 3) in a channels-last representation. (In a [row, col] assumption, this makes each <em>column</em> a set of pixels, and each <em>row</em> a set of columns.) A set of 1800 color images (1 minute video at 30fps) would be a rank-4 tensor with shape (1800, 3, 28, 28); a set of 100 videos would have shape (100, 1800, 3, 28, 28).</p>
<p>If this were stored in the R array <code>data</code>, then <code>data[20, 57, , , ]</code> would select the color image from the 57th frame of the 20th video. By default it would return the shape (3, 28, 28) array from that location, dropping the ranks with only one entry. (This doc similarly refers to individual ‘ranks’ of a tensor, rather than the sometimes used ‘axes’, mirroring the rank/dimension distinction.) This can be avoided with an additional <code>drop = F</code> parameter: <code>data[20, 57, , , , drop = F]</code> returns the rank-5 tensor with shape (1, 1, 3, 28, 28).</p>
</div>
<div id="printing" class="section level3">
<h3 class="hasAnchor">
<a href="#printing" class="anchor" aria-hidden="true"></a>Printing</h3>
<p>The default print function for arrays in R is… not great. Whereas groups are typically organized in tensors “leftward,” R breaks them down “rightward” and provides little hierarchical organization. (I think Python’s <code>numpy</code> arrays are better in this regard, but still leave a lot to be desired.) Consider a simulated dataset of 4 color 10x10 images (channels-first):</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">simulated</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">4</span><span class="op">*</span><span class="fl">3</span><span class="op">*</span><span class="fl">10</span><span class="op">*</span><span class="fl">10</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">3</span>, <span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>, , 1, 1

           [,1]      [,2]      [,3]
[1,] 0.04040316 0.0736798 0.5612521
[2,] 0.13227164 0.2328002 0.6063468
[3,] 0.26599225 0.7696131 0.4620570
[4,] 0.71158177 0.5504166 0.0786895

, , 2, 1

          [,1]      [,2]      [,3]
[1,] 0.5346928 0.9155100 0.6935304
[2,] 0.6718270 0.2523032 0.3734726
[3,] 0.8564285 0.0440457 0.9548660
[4,] 0.8864082 0.2974628 0.5131614

, , 3, 1

          [,1]      [,2]      [,3]
[1,] 0.3815334 0.6023006 0.7830635
[2,] 0.7125469 0.4438918 0.3053601
(output truncated)</code></pre>
<p>TidyTensor provides a customized <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code> by allowing R vectors, matrices, and arrays to be converted with <code><a href="reference/as.tidytensor.html">as.tidytensor()</a></code>, or the shorthand <code><a href="reference/tt.html">tt()</a></code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">tidytensor</span><span class="op">)</span>
<span class="va">simulated</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="reference/tt.html">tt</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code># Rank 4 tensor, shape: (4, 3, 10, 10)
|  # Rank 3 tensor, shape: (3, 10, 10)
|  |  # Rank 2 tensor, shape: (10, 10)
|  |      0.131  0.0499  0.674   0.104  0.525  0.0333  ... 
|  |      0.121   0.456  0.404   0.141   0.58   0.235  ... 
|  |      0.516  0.0342  0.407   0.187   0.64   0.805  ... 
|  |      0.172   0.445  0.446   0.565  0.187   0.622  ... 
|  |      0.173   0.442  0.857  0.0947  0.012   0.757  ... 
|  |      0.149    0.76  0.823   0.249  0.361   0.866  ... 
|  |        ...     ...    ...     ...    ...     ...  ... 
|  |  # ...
|  # ...</code></pre>
<p>Here the printout is emphasizing the nested nature of tensors and providing a quick structure summary.</p>
<p><code><a href="reference/as.tidytensor.html">as.tidytensor()</a></code> simply adds an addtional <code>tidytensor</code> class entry, so the array can still be used in all the normal ways. The <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code> function can be customized to show more or fewers rows and columns in the “bottom” tensors and to show dimension names there (it’s on the TODO list to also show dimesion names for higher ranks when printing).</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/dimnames.html" class="external-link">dimnames</a></span><span class="op">(</span><span class="va">simulated</span><span class="op">)</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>
<span class="va">simulated</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="reference/tt.html">tt</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>show_names <span class="op">=</span> <span class="cn">T</span>, max_rows <span class="op">=</span> <span class="fl">10</span>, max_cols <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></code></pre></div>
<pre><code># Rank 4 tensor, shape: (4, 3, 10, 10)
|  # Rank 3 tensor, shape: (3, 10, 10)
|  |  # Rank 2 tensor, shape: (10, 10)
|  |               [,1]    [,2]     [,3]    [,4]   [,5]     [,6]    [,7]    [,8]    [,9]    [,10] 
|  |      ["a",]  0.364   0.324    0.634  0.0693  0.105    0.198   0.502   0.614   0.699    0.102 
|  |      ["b",]  0.523   0.699    0.483   0.455  0.256    0.296   0.834   0.629  0.0319    0.363 
|  |      ["c",]   0.64    0.51    0.947   0.451  0.454    0.685  0.0643   0.759   0.713    0.474 
|  |      ["d",]  0.381  0.0602    0.665   0.108  0.481  0.00834   0.189   0.637   0.943  0.00697 
|  |      ["e",]  0.598   0.635    0.911  0.0918  0.774     0.95  0.0749  0.0682   0.947    0.488 
|  |      ["f",]  0.831   0.114    0.939    0.89  0.748    0.424    0.98   0.711  0.0683     0.19 
|  |      ["g",]  0.411   0.356    0.786   0.617  0.293    0.852  0.0518    0.16    0.57    0.626 
|  |      ["h",]  0.643    0.98    0.759   0.755  0.372    0.249   0.765   0.411   0.665    0.111 
|  |      ["i",]  0.509   0.905    0.631   0.318  0.651    0.937   0.349   0.402   0.693    0.939 
|  |      ["j",]  0.524   0.801  0.00265    0.51  0.573     0.38   0.199   0.722   0.679    0.417 
|  |  # ...
|  # ...</code></pre>
<p>And we can see more of the structure by increasing the <code>max_per_level</code> parameter:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">images</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="reference/tt.html">tt</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>max_per_level <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<pre><code># Rank 4 tensor, shape: (4, 3, 10, 10)
|  # Rank 3 tensor, shape: (3, 10, 10)
|  |  # Rank 2 tensor, shape: (10, 10)
|  |      0.364   0.324  0.634  0.0693  0.105    0.198  ... 
|  |      0.523   0.699  0.483   0.455  0.256    0.296  ... 
|  |       0.64    0.51  0.947   0.451  0.454    0.685  ... 
|  |      0.381  0.0602  0.665   0.108  0.481  0.00834  ... 
|  |      0.598   0.635  0.911  0.0918  0.774     0.95  ... 
|  |      0.831   0.114  0.939    0.89  0.748    0.424  ... 
|  |        ...     ...    ...     ...    ...      ...  ... 
|  |  # Rank 2 tensor, shape: (10, 10)
|  |       0.984  0.955  0.0646    0.92   0.47  0.365  ... 
|  |      0.0408  0.507   0.436  0.0577   0.34  0.899  ... 
|  |        0.72  0.169   0.582   0.416  0.796  0.763  ... 
|  |       0.809  0.669   0.878   0.905   0.04  0.812  ... 
|  |        0.91  0.498  0.0835   0.792  0.602  0.367  ... 
|  |       0.695  0.394   0.895     0.7  0.942  0.983  ... 
|  |         ...    ...     ...     ...    ...    ...  ... 
|  |  # ...
|  # Rank 3 tensor, shape: (3, 10, 10)
|  |  # Rank 2 tensor, shape: (10, 10)
|  |      0.919   0.502   0.825   0.761   0.408  0.323  ... 
|  |      0.909   0.731   0.629   0.101   0.987  0.119  ... 
|  |      0.388   0.126    0.87   0.504   0.215  0.621  ... 
|  |      0.186  0.0857  0.0534   0.338   0.164   0.31  ... 
|  |      0.431    0.26   0.302   0.953  0.0398   0.52  ... 
|  |      0.853   0.157   0.812  0.0338   0.782   0.27  ... 
|  |        ...     ...     ...     ...     ...    ...  ... 
|  |  # Rank 2 tensor, shape: (10, 10)
|  |       0.341    0.189   0.871   0.761  0.0608  0.951  ... 
|  |       0.593   0.0416   0.582    0.77   0.068  0.693  ... 
|  |       0.605    0.581   0.953   0.868   0.634   0.26  ... 
|  |      0.0969  0.00446   0.953  0.0621   0.336  0.151  ... 
|  |       0.148    0.646  0.0294   0.436   0.646  0.111  ... 
|  |       0.511    0.873   0.472   0.435  0.0883  0.113  ... 
|  |         ...      ...     ...     ...     ...    ...  ... 
|  |  # ...
|  # ...</code></pre>
<p>What if our data were in channels-last configuration? In cases where we want to visualize the last rank as a vector within a matrix like this (pixels in an image, or channels in a filter map) we can specify <code>bottom = "3d"</code>.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">4</span><span class="op">*</span><span class="fl">10</span><span class="op">*</span><span class="fl">10</span><span class="op">*</span><span class="fl">3</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="reference/tt.html">tt</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>bottom <span class="op">=</span> <span class="st">"3d"</span><span class="op">)</span></code></pre></div>
<pre><code># Rank 4 tensor, shape: (4, 10, 10, 3)
|  # Rank 3 tensor, shape: (10, 10, 3)
|        [0.45, 0.177, 0.791]   [0.687, 0.617, 0.677]  [0.144, 0.352, 0.687]    [0.999, 0.44, 0.963]   [0.0476, 0.581, 0.309]  [0.735, 0.729, 0.308]  ... 
|        [0.707, 0.36, 0.877]   [0.765, 0.966, 0.069]  [0.427, 0.053, 0.248]   [0.243, 0.617, 0.452]   [0.899, 0.243, 0.0638]   [0.83, 0.523, 0.665]  ... 
|        [0.23, 0.853, 0.844]   [0.165, 0.436, 0.984]  [0.833, 0.404, 0.211]  [0.692, 0.0292, 0.349]   [0.425, 0.0624, 0.736]  [0.176, 0.351, 0.667]  ... 
|       [0.233, 0.815, 0.237]   [0.697, 0.205, 0.462]  [0.918, 0.652, 0.592]    [0.217, 0.43, 0.971]     [0.815, 0.603, 0.86]  [0.803, 0.778, 0.186]  ... 
|       [0.487, 0.631, 0.569]  [0.545, 0.382, 0.0933]   [0.662, 0.56, 0.439]  [0.0766, 0.634, 0.534]    [0.867, 0.153, 0.158]   [0.608, 0.881, 0.19]  ... 
|      [0.108, 0.0783, 0.125]   [0.267, 0.937, 0.339]  [0.445, 0.416, 0.928]   [0.822, 0.949, 0.258]  [0.456, 0.943, 0.00864]  [0.678, 0.627, 0.232]  ... 
|                         ...                     ...                    ...                     ...                      ...                    ...  ... 
|  # ...</code></pre>
<p>Here each channel is represented as a vector within the grid. There’s also a <code>bottom = "1d"</code> for situations where a grid display doesn’t make sense.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">4</span><span class="op">*</span><span class="fl">10</span><span class="op">*</span><span class="fl">8</span><span class="op">)</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">10</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="reference/tt.html">tt</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>bottom <span class="op">=</span> <span class="st">"1d"</span>, max_per_level <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<pre><code># Rank 3 tensor, shape: (4, 10, 8)
|  # Rank 2 tensor, shape: (10, 8)
|  |  # Rank 1 tensor, shape: (8)
|  |      0.291  0.751  -0.0842  0.991  -0.626  -0.6  ... 
|  |  # Rank 1 tensor, shape: (8)
|  |      0.814  -0.478  1.15  -0.244  -1.62  -1.28  ... 
|  |  # ...
|  # Rank 2 tensor, shape: (10, 8)
|  |  # Rank 1 tensor, shape: (8)
|  |      -0.987  -0.451  2.17  0.838  0.646  -0.868  ... 
|  |  # Rank 1 tensor, shape: (8)
|  |      0.429  0.481  -0.339  -1.78  0.332  1.42  ... 
|  |  # ...
|  # ...</code></pre>
<p>The default for <code>bottom</code> is <code>"auto"</code>, which selects <code>"2d"</code> when the input looks like a set of channels-first images (3rd-to-last rank is of size 3, or last two ranks are equal in size), <code>"3d"</code> if it looks like a channels-last image (last rank is of size 3 or 1), and otherwise falls back to <code>"1d"</code>.</p>
</div>
<div id="named-ranks" class="section level3">
<h3 class="hasAnchor">
<a href="#named-ranks" class="anchor" aria-hidden="true"></a>Named Ranks</h3>
<p>Tidytensors support <code><a href="reference/ranknames.html">ranknames()</a></code> in addition to <code><a href="https://rdrr.io/r/base/dimnames.html" class="external-link">dimnames()</a></code> (implemented as <code>names(dimnames())</code>) for meaningful annotation. Here’s a basic print for the CIFAR10 dataset provided by <code>keras</code>:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://keras.rstudio.com" class="external-link">keras</a></span><span class="op">)</span>

<span class="va">images</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://keras.rstudio.com/reference/dataset_cifar10.html" class="external-link">dataset_cifar10</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">train</span><span class="op">$</span><span class="va">x</span>
<span class="va">images</span> <span class="op"><a href="https://keras.rstudio.com/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="reference/tt.html">tt</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code># Rank 4 tensor, shape: (50000, 32, 32, 3)
|  # Rank 3 tensor, shape: (32, 32, 3)
|      [59, 62, 63]  [43, 46, 45]   [50, 48, 43]   [68, 54, 42]   [98, 73, 52]  [119, 91, 63]  ... 
|      [16, 20, 20]     [0, 0, 0]     [18, 8, 0]    [51, 27, 8]   [88, 51, 21]  [120, 82, 43]  ... 
|      [25, 24, 21]    [16, 7, 0]    [49, 27, 8]   [83, 50, 23]  [110, 72, 41]  [129, 92, 54]  ... 
|      [33, 25, 17]   [38, 20, 4]   [87, 54, 25]  [106, 63, 28]  [115, 70, 33]  [117, 74, 35]  ... 
|      [50, 32, 21]  [59, 32, 11]  [102, 65, 34]  [127, 79, 39]  [124, 77, 36]  [121, 77, 36]  ... 
|      [71, 48, 29]  [84, 53, 24]  [110, 73, 37]  [129, 82, 38]  [136, 88, 45]  [131, 84, 42]  ... 
|               ...           ...            ...            ...            ...            ...  ... 
|  # ...
</code></pre>
<p>A set of 50000 32x32 RGB images, in a channels-last organization. We can set ranknames with either <code>ranknames(t) &lt;-</code> syntax or the <code>%&gt;%</code>-friendly and bare-name ready <code><a href="reference/set_ranknames.html">set_ranknames()</a></code>.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">images</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://keras.rstudio.com/reference/dataset_cifar10.html" class="external-link">dataset_cifar10</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">train</span><span class="op">$</span><span class="va">x</span>

<span class="va">images</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/tt.html">tt</a></span><span class="op">(</span><span class="va">images</span><span class="op">)</span>
<span class="fu"><a href="reference/ranknames.html">ranknames</a></span><span class="op">(</span><span class="va">images</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"image"</span>, <span class="st">"row"</span>, <span class="st">"col"</span>, <span class="st">"channel"</span><span class="op">)</span>
<span class="va">images</span>

<span class="co"># OR</span>
<span class="va">images</span> <span class="op"><a href="https://keras.rstudio.com/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="reference/tt.html">tt</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://keras.rstudio.com/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="reference/set_ranknames.html">set_ranknames</a></span><span class="op">(</span><span class="va">image</span>, <span class="va">row</span>, <span class="va">col</span>, <span class="va">channel</span><span class="op">)</span>

<span class="co"># OR</span>
<span class="va">images</span> <span class="op"><a href="https://keras.rstudio.com/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="reference/tt.html">tt</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://keras.rstudio.com/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="reference/set_ranknames.html">set_ranknames</a></span><span class="op">(</span>.dots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"image"</span>, <span class="st">"row"</span>, <span class="st">"col"</span>, <span class="st">"channel"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code># Rank 4 tensor, shape: (50000, 32, 32, 3), ranknames: image, row, col, channel
|  # Rank 3 tensor, shape: (32, 32, 3)
|      [59, 62, 63]  [43, 46, 45]   [50, 48, 43]   [68, 54, 42]   [98, 73, 52]  [119, 91, 63]  ... 
|      [16, 20, 20]     [0, 0, 0]     [18, 8, 0]    [51, 27, 8]   [88, 51, 21]  [120, 82, 43]  ... 
|      [25, 24, 21]    [16, 7, 0]    [49, 27, 8]   [83, 50, 23]  [110, 72, 41]  [129, 92, 54]  ... 
|      [33, 25, 17]   [38, 20, 4]   [87, 54, 25]  [106, 63, 28]  [115, 70, 33]  [117, 74, 35]  ... 
|      [50, 32, 21]  [59, 32, 11]  [102, 65, 34]  [127, 79, 39]  [124, 77, 36]  [121, 77, 36]  ... 
|      [71, 48, 29]  [84, 53, 24]  [110, 73, 37]  [129, 82, 38]  [136, 88, 45]  [131, 84, 42]  ... 
|               ...           ...            ...            ...            ...            ...  ... 
|  # ...</code></pre>
<p>(Another TODO: show ranknames for bottom ranks at those levels as well.)</p>
<p>Named ranks make a variety of operations easier, or at least more explicit. For example, we may wish to permute the ranks to a channels-first representation, then set dimensions names for the <code>channel</code> rank.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">images</span> <span class="op"><a href="https://keras.rstudio.com/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="reference/tt.html">tt</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://keras.rstudio.com/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="reference/set_ranknames.html">set_ranknames</a></span><span class="op">(</span><span class="va">image</span>, <span class="va">row</span>, <span class="va">col</span>, <span class="va">channel</span><span class="op">)</span> <span class="op"><a href="https://keras.rstudio.com/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="reference/permute.html">permute</a></span><span class="op">(</span><span class="va">image</span>, <span class="va">channel</span>, <span class="va">row</span>, <span class="va">col</span><span class="op">)</span> <span class="op"><a href="https://keras.rstudio.com/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="reference/set_dimnames_for_rank.html">set_dimnames_for_rank</a></span><span class="op">(</span><span class="va">channel</span>, <span class="va">R</span>, <span class="va">G</span>, <span class="va">B</span><span class="op">)</span> <span class="op"><a href="https://keras.rstudio.com/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>max_per_level <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<pre><code># Rank 4 tensor, shape: (50000, 3, 32, 32), ranknames: image, channel, row, col
|  # Rank 3 tensor, shape: (3, 32, 32)
|  |  # Rank 2 tensor, shape: (32, 32)
|  |       59   43   50   68   98  119  ... 
|  |       16    0   18   51   88  120  ... 
|  |       25   16   49   83  110  129  ... 
|  |       33   38   87  106  115  117  ... 
|  |       50   59  102  127  124  121  ... 
|  |       71   84  110  129  136  131  ... 
|  |      ...  ...  ...  ...  ...  ...  ... 
|  |  # Rank 2 tensor, shape: (32, 32)
|  |       62   46   48   54   73   91  ... 
|  |       20    0    8   27   51   82  ... 
|  |       24    7   27   50   72   92  ... 
|  |       25   20   54   63   70   74  ... 
|  |       32   32   65   79   77   77  ... 
|  |       48   53   73   82   88   84  ... 
|  |      ...  ...  ...  ...  ...  ...  ... 
|  |  # ...
|  # Rank 3 tensor, shape: (3, 32, 32)
|  |  # Rank 2 tensor, shape: (32, 32)
|  |      154  126  105  102  125  155  ... 
|  |      140  145  125  124  150  152  ... 
|  |      140  139  115  147  138  132  ... 
|  |      136  137  122  132  151  181  ... 
|  |      129  141  136  186  215  202  ... 
|  |      136  136  127  153  138  120  ... 
|  |      ...  ...  ...  ...  ...  ...  ... 
|  |  # Rank 2 tensor, shape: (32, 32)
|  |      177  137  104  101  131  166  ... 
|  |      160  153  125  129  161  164  ... 
|  |      155  146  115  153  150  145  ... 
|  |      147  142  121  133  157  193  ... 
|  |      137  146  139  186  220  216  ... 
|  |      144  149  148  172  160  141  ... 
|  |      ...  ...  ...  ...  ...  ...  ... 
|  |  # ...
|  # ...</code></pre>
</div>
<div id="converting-to-dataframe-and-plotting" class="section level3">
<h3 class="hasAnchor">
<a href="#converting-to-dataframe-and-plotting" class="anchor" aria-hidden="true"></a>Converting to <code>data.frame</code> and plotting</h3>
<p>Named ranks also work well with conversion to data frame. We’ll convert just a few images, because tensors in data frame representation are significantly larger (approximately number-of-ranks times as large). <code><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame()</a></code> will by default throw an error when more than a 10-million-entry data frame would result, unless <code>allow_huge = TRUE</code> is set.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">images</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, , , <span class="op">]</span> <span class="op"><a href="https://keras.rstudio.com/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="reference/tt.html">tt</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://keras.rstudio.com/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="reference/set_ranknames.html">set_ranknames</a></span><span class="op">(</span><span class="va">image</span>, <span class="va">row</span>, <span class="va">col</span>, <span class="va">channel</span><span class="op">)</span> <span class="op"><a href="https://keras.rstudio.com/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="reference/permute.html">permute</a></span><span class="op">(</span><span class="va">image</span>, <span class="va">channel</span>, <span class="va">row</span>, <span class="va">col</span><span class="op">)</span> <span class="op"><a href="https://keras.rstudio.com/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="reference/set_dimnames_for_rank.html">set_dimnames_for_rank</a></span><span class="op">(</span><span class="va">channel</span>, <span class="va">R</span>, <span class="va">G</span>, <span class="va">B</span><span class="op">)</span> <span class="op"><a href="https://keras.rstudio.com/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://keras.rstudio.com/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>  image channel row col value
1     1       R   1   1    59
2     2       R   1   1   154
3     3       R   1   1   255
4     4       R   1   1    28
5     1       G   1   1    62
6     2       G   1   1   177</code></pre>
<p>The third row here indicates that the value in <code>images[3, "R", 1, 1]</code> is 255. Non-named tensors get generic column names. In the case of set <code><a href="https://rdrr.io/r/base/dimnames.html" class="external-link">dimnames()</a></code> as in <code>R</code>, <code>G</code>, and <code>B</code> above, factors are created with the level ordering determined by the <code><a href="https://rdrr.io/r/base/dimnames.html" class="external-link">dimnames()</a></code> ordering.</p>
<p>This provides a nice interface for visualization with <code>ggplot2</code>.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">images</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, , , <span class="op">]</span> <span class="op"><a href="https://keras.rstudio.com/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="reference/tt.html">tt</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://keras.rstudio.com/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="reference/set_ranknames.html">set_ranknames</a></span><span class="op">(</span><span class="va">image</span>, <span class="va">row</span>, <span class="va">col</span>, <span class="va">channel</span><span class="op">)</span> <span class="op"><a href="https://keras.rstudio.com/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="reference/permute.html">permute</a></span><span class="op">(</span><span class="va">image</span>, <span class="va">channel</span>, <span class="va">row</span>, <span class="va">col</span><span class="op">)</span> <span class="op"><a href="https://keras.rstudio.com/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="reference/set_dimnames_for_rank.html">set_dimnames_for_rank</a></span><span class="op">(</span><span class="va">channel</span>, <span class="va">R</span>, <span class="va">G</span>, <span class="va">B</span><span class="op">)</span> <span class="op"><a href="https://keras.rstudio.com/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://keras.rstudio.com/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_tile</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">col</span>, y <span class="op">=</span> <span class="va">row</span>, fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">facet_grid</span><span class="op">(</span><span class="va">channel</span> <span class="op">~</span> <span class="va">image</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">coord_equal</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="docs/images/cifar_multi.png" width="750"></p>
<p>It’s a little hard to make out, but these images are upside-down, because image data are typically encoded with an inverted y-axis, so next time we’ll add a <code><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_reverse()</a></code> as well. To get fancy, we can use <code><a href="https://tidyr.tidyverse.org/reference/spread.html" class="external-link">tidyr::spread()</a></code> to create individual <code>R</code>, <code>G</code>, and <code>B</code> columns, combined with <code><a href="https://rdrr.io/r/grDevices/rgb.html" class="external-link">rgb()</a></code> and <code><a href="https://ggplot2.tidyverse.org/reference/scale_identity.html" class="external-link">scale_fill_identity()</a></code> to merge the channels into color images.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span>

<span class="va">images</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, , , <span class="op">]</span> <span class="op"><a href="https://tidyr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="reference/tt.html">tt</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://tidyr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="reference/set_ranknames.html">set_ranknames</a></span><span class="op">(</span><span class="va">image</span>, <span class="va">row</span>, <span class="va">col</span>, <span class="va">channel</span><span class="op">)</span> <span class="op"><a href="https://tidyr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="reference/permute.html">permute</a></span><span class="op">(</span><span class="va">image</span>, <span class="va">channel</span>, <span class="va">row</span>, <span class="va">col</span><span class="op">)</span> <span class="op"><a href="https://tidyr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="reference/set_dimnames_for_rank.html">set_dimnames_for_rank</a></span><span class="op">(</span><span class="va">channel</span>, <span class="va">R</span>, <span class="va">G</span>, <span class="va">B</span><span class="op">)</span> <span class="op"><a href="https://tidyr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://tidyr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/spread.html" class="external-link">spread</a></span><span class="op">(</span><span class="va">channel</span>, <span class="va">value</span><span class="op">)</span> <span class="op"><a href="https://tidyr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_tile</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">col</span>, y <span class="op">=</span> <span class="va">row</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html" class="external-link">rgb</a></span><span class="op">(</span><span class="va">R</span>, <span class="va">G</span>, <span class="va">B</span>, maxColorValue <span class="op">=</span> <span class="fl">255</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">facet_wrap</span><span class="op">(</span> <span class="op">~</span> <span class="va">image</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">coord_equal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">scale_y_reverse</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">scale_fill_identity</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="docs/images/cifar_color.png" width="400"></p>
<p>These techniques work nicely for model investigation, for example in plotting internal feature maps produced by deep models. We’ll start by importing a predefined model and creating a function that maps input tensors to feature maps using the <code>keras</code> API.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">vgg_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://keras.rstudio.com/reference/application_vgg.html" class="external-link">application_vgg16</a></span><span class="op">(</span>include_top <span class="op">=</span> <span class="cn">FALSE</span>, input_shape <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">32</span>, <span class="fl">32</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>

<span class="va">input</span> <span class="op">&lt;-</span> <span class="va">vgg_model</span><span class="op">$</span><span class="va">input</span>
<span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://keras.rstudio.com/reference/get_layer.html" class="external-link">get_layer</a></span><span class="op">(</span><span class="va">vgg_model</span>, name <span class="op">=</span> <span class="st">"block1_conv2"</span><span class="op">)</span><span class="op">$</span><span class="va">output</span>

<span class="co"># input shape (N, 32, 32, 3)</span>
<span class="co"># output shape (N, 32, 32, 64) tensor, where last rank are feature maps</span>
<span class="va">compute_featuremaps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://keras.rstudio.com/reference/k_function.html" class="external-link">k_function</a></span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span></code></pre></div>
<p>To visualize the feature maps we generate an output tensor, name it, convert it to data frame, select only the first six featuremaps with <code><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">dplyr::filter()</a></code> to keep it reasonable, and then plot the values.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>

<span class="fu">compute_featuremaps</span><span class="op">(</span><span class="va">images</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, , ,<span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="reference/tt.html">tt</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="reference/set_ranknames.html">set_ranknames</a></span><span class="op">(</span><span class="va">image</span>, <span class="va">row</span>, <span class="va">col</span>, <span class="va">featuremap</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span>allow_huge <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">featuremap</span> <span class="op">&lt;=</span> <span class="fl">6</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_tile</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">col</span>, y <span class="op">=</span> <span class="va">row</span>, fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">facet_grid</span><span class="op">(</span><span class="va">image</span> <span class="op">~</span> <span class="va">featuremap</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">coord_equal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">scale_y_reverse</span><span class="op">(</span><span class="op">)</span> </code></pre></div>
<p><img src="docs/images/feature_maps.png" width="850"></p>
</div>
<div id="manipulation" class="section level3">
<h3 class="hasAnchor">
<a href="#manipulation" class="anchor" aria-hidden="true"></a>Manipulation</h3>
<div id="c-and-bind" class="section level4">
<h4 class="hasAnchor">
<a href="#c-and-bind" class="anchor" aria-hidden="true"></a><code>c()</code> and <code>bind()</code>
</h4>
<p>A few functions are included for transforming or working with tensors. We’ve already seen <code><a href="reference/permute.html">permute()</a></code> which re-orders ranks (and is a rankname-aware wrapper around <code><a href="https://rdrr.io/r/base/aperm.html" class="external-link">base::aperm()</a></code>). There are also <code><a href="https://rdrr.io/r/base/c.html" class="external-link">c()</a></code> and <code><a href="reference/bind.html">bind()</a></code>. To start with we’ll extract three subsets of CIFAR10 images of different sizes; <code><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset()</a></code> provides a <code>%&gt;%</code>-friendly alternative to <code>[]</code>.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">images</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://keras.rstudio.com/reference/dataset_cifar10.html" class="external-link">dataset_cifar10</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">train</span><span class="op">$</span><span class="va">x</span>
<span class="va">images</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/tt.html">tt</a></span><span class="op">(</span><span class="va">images</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="reference/set_ranknames.html">set_ranknames</a></span><span class="op">(</span><span class="va">image</span>, <span class="va">row</span>, <span class="va">col</span>, <span class="va">channel</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="reference/set_dimnames_for_rank.html">set_dimnames_for_rank</a></span><span class="op">(</span><span class="va">channel</span>, <span class="va">R</span>, <span class="va">G</span>, <span class="va">B</span><span class="op">)</span>

<span class="va">seta</span> <span class="op">&lt;-</span> <span class="va">images</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, , ,<span class="op">]</span>
<span class="va">setb</span> <span class="op">&lt;-</span> <span class="va">images</span><span class="op">[</span><span class="fl">5</span><span class="op">:</span><span class="fl">7</span>, , ,<span class="op">]</span>
<span class="va">setc</span> <span class="op">&lt;-</span> <span class="va">images</span><span class="op">[</span><span class="fl">8</span><span class="op">:</span><span class="fl">16</span>, , ,<span class="op">]</span>

<span class="va">seta</span> <span class="op">&lt;-</span> <span class="va">images</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span>image <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span>
<span class="va">setb</span> <span class="op">&lt;-</span> <span class="va">images</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span>image <span class="op">=</span> <span class="fl">5</span><span class="op">:</span><span class="fl">8</span><span class="op">)</span>
<span class="va">setc</span> <span class="op">&lt;-</span> <span class="va">images</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span>image <span class="op">=</span> <span class="fl">9</span><span class="op">:</span><span class="fl">16</span><span class="op">)</span></code></pre></div>
<p>While on the subset of <code><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset()</a></code>, the syntax allows using ranknames as above, or in the case of not specifying by name uses the first ranks; e.g. <code>subset(images, 1:4, 1:10, 1:12)</code> selects the first 4 images, the first 10 rows, the first 12 columns, and all of other unspecified ranks, as does <code>subset(images, image = 1:4, row = 1:10, col = 1:12)</code>. If the dimensions are named, those can be used as well, and the function also takes a <code>drop</code> argument defaulting to <code>TRUE</code> to drop ranks with only one entry (to match <code>[]</code> functionality), as in <code>subset(images, image = 1, channel = c("G", "B"), drop = FALSE)</code> selects all rows, all columns, and just the green and blue channels from the first image, without dropping the image rank.</p>
<p>The <code><a href="https://rdrr.io/r/base/c.html" class="external-link">c()</a></code> function concatenates multiple tensors of the same shape except for the first rank, into a single tensor representing a concatenated set. (<code><a href="https://rdrr.io/r/base/c.html" class="external-link">c()</a></code> can also take a list of tensors.)</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">seta</span>, <span class="va">setb</span>, <span class="va">setc</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></code></pre></div>
<pre><code># Rank 4 tensor, shape: (16, 32, 32, 3), ranknames: image, row, col, channel
|  # Rank 3 tensor, shape: (32, 32, 3)
|      [59, 62, 63]  [43, 46, 45]   [50, 48, 43]   [68, 54, 42]   [98, 73, 52]  [119, 91, 63]  ... 
|      [16, 20, 20]     [0, 0, 0]     [18, 8, 0]    [51, 27, 8]   [88, 51, 21]  [120, 82, 43]  ... 
|      [25, 24, 21]    [16, 7, 0]    [49, 27, 8]   [83, 50, 23]  [110, 72, 41]  [129, 92, 54]  ... 
|      [33, 25, 17]   [38, 20, 4]   [87, 54, 25]  [106, 63, 28]  [115, 70, 33]  [117, 74, 35]  ... 
|      [50, 32, 21]  [59, 32, 11]  [102, 65, 34]  [127, 79, 39]  [124, 77, 36]  [121, 77, 36]  ... 
|      [71, 48, 29]  [84, 53, 24]  [110, 73, 37]  [129, 82, 38]  [136, 88, 45]  [131, 84, 42]  ... 
|               ...           ...            ...            ...            ...            ...  ... 
|  # ...</code></pre>
<p><code><a href="reference/bind.html">bind()</a></code>, on the other hand, collects multiple tensors of the <em>exact</em> same shape into a new tensor with one higher rank.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/bind.html">bind</a></span><span class="op">(</span><span class="va">seta</span>, <span class="va">setb</span>, new_rank_name <span class="op">=</span> <span class="st">"sets"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></code></pre></div>
<pre><code># Rank 5 tensor, shape: (2, 4, 32, 32, 3), ranknames: sets, image, row, col, channel
|  # Rank 4 tensor, shape: (4, 32, 32, 3)
|  |  # Rank 3 tensor, shape: (32, 32, 3)
|  |      [59, 62, 63]  [43, 46, 45]   [50, 48, 43]   [68, 54, 42]   [98, 73, 52]  [119, 91, 63]  ... 
|  |      [16, 20, 20]     [0, 0, 0]     [18, 8, 0]    [51, 27, 8]   [88, 51, 21]  [120, 82, 43]  ... 
|  |      [25, 24, 21]    [16, 7, 0]    [49, 27, 8]   [83, 50, 23]  [110, 72, 41]  [129, 92, 54]  ... 
|  |      [33, 25, 17]   [38, 20, 4]   [87, 54, 25]  [106, 63, 28]  [115, 70, 33]  [117, 74, 35]  ... 
|  |      [50, 32, 21]  [59, 32, 11]  [102, 65, 34]  [127, 79, 39]  [124, 77, 36]  [121, 77, 36]  ... 
|  |      [71, 48, 29]  [84, 53, 24]  [110, 73, 37]  [129, 82, 38]  [136, 88, 45]  [131, 84, 42]  ... 
|  |               ...           ...            ...            ...            ...            ...  ... 
|  |  # ...
|  # ...</code></pre>
</div>
<div id="partition-and-aslist" class="section level4">
<h4 class="hasAnchor">
<a href="#partition-and-aslist" class="anchor" aria-hidden="true"></a><code>partition()</code> and <code>as.list()</code>
</h4>
<p>The <code><a href="reference/partition.html">partition()</a></code> function works as an inverse of <code><a href="https://rdrr.io/r/base/c.html" class="external-link">c()</a></code>, partitioning a tensor into a list of tensors of relative proportions along the first rank, which may be handy for generating train/validate/test splits (particularly when combined with <code><a href="reference/shuffle.html">shuffle()</a></code>, below).</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">images</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/tt.html">tt</a></span><span class="op">(</span><span class="va">images</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="reference/set_ranknames.html">set_ranknames</a></span><span class="op">(</span><span class="va">image</span>, <span class="va">row</span>, <span class="va">col</span>, <span class="va">channel</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="reference/set_dimnames_for_rank.html">set_dimnames_for_rank</a></span><span class="op">(</span><span class="va">channel</span>, <span class="va">R</span>, <span class="va">G</span>, <span class="va">B</span><span class="op">)</span>

<span class="va">labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://keras.rstudio.com/reference/dataset_cifar10.html" class="external-link">dataset_cifar10</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">train</span><span class="op">$</span><span class="va">y</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="reference/tt.html">tt</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="reference/set_ranknames.html">set_ranknames</a></span><span class="op">(</span><span class="va">image</span>, <span class="va">label</span><span class="op">)</span>
  
<span class="va">split_images</span> <span class="op">&lt;-</span> <span class="va">images</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="reference/partition.html">partition</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.8</span><span class="op">)</span><span class="op">)</span>
<span class="va">split_labels</span> <span class="op">&lt;-</span> <span class="va">labels</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="reference/partition.html">partition</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.8</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">split_images</span><span class="op">)</span></code></pre></div>
<pre><code>[[1]]
# Rank 4 tensor, shape: (5000, 32, 32, 3), ranknames: image, row, col, channel
|  # Rank 3 tensor, shape: (32, 32, 3)
|      [59, 62, 63]  [43, 46, 45]   [50, 48, 43]   [68, 54, 42]   [98, 73, 52]  [119, 91, 63]  ... 
|      [16, 20, 20]     [0, 0, 0]     [18, 8, 0]    [51, 27, 8]   [88, 51, 21]  [120, 82, 43]  ... 
|      [25, 24, 21]    [16, 7, 0]    [49, 27, 8]   [83, 50, 23]  [110, 72, 41]  [129, 92, 54]  ... 
|      [33, 25, 17]   [38, 20, 4]   [87, 54, 25]  [106, 63, 28]  [115, 70, 33]  [117, 74, 35]  ... 
|      [50, 32, 21]  [59, 32, 11]  [102, 65, 34]  [127, 79, 39]  [124, 77, 36]  [121, 77, 36]  ... 
|      [71, 48, 29]  [84, 53, 24]  [110, 73, 37]  [129, 82, 38]  [136, 88, 45]  [131, 84, 42]  ... 
|               ...           ...            ...            ...            ...            ...  ... 
|  # ...

[[2]]
# Rank 4 tensor, shape: (5000, 32, 32, 3), ranknames: image, row, col, channel
|  # Rank 3 tensor, shape: (32, 32, 3)
|         [60, 82, 54]     [40, 68, 36]     [52, 81, 52]     [57, 83, 56]     [45, 72, 43]  [48, 76, 48]  ... 
|      [112, 114, 114]     [58, 71, 56]     [58, 81, 53]     [59, 88, 58]     [47, 80, 52]  [50, 83, 54]  ... 
|      [170, 161, 178]  [119, 118, 120]     [80, 89, 74]     [63, 86, 62]     [53, 85, 58]  [51, 85, 57]  ... 
|      [180, 170, 190]  [182, 171, 186]  [141, 135, 138]     [84, 95, 80]     [53, 80, 55]  [50, 82, 55]  ... 
|      [129, 121, 133]  [167, 154, 170]  [173, 161, 175]  [134, 133, 131]     [78, 88, 72]  [55, 74, 51]  ... 
|         [62, 55, 58]   [104, 94, 104]  [152, 142, 158]  [168, 156, 170]  [145, 133, 137]  [94, 92, 80]  ... 
|                  ...              ...              ...              ...              ...           ...  ... 
|  # ...

[[3]]
# Rank 4 tensor, shape: (40000, 32, 32, 3), ranknames: image, row, col, channel
|  # Rank 3 tensor, shape: (32, 32, 3)
|         [35, 25, 26]  [27, 21, 21]  [25, 20, 19]  [26, 18, 18]  [24, 15, 15]  [22, 13, 14]  ... 
|         [63, 55, 50]  [32, 27, 21]   [17, 13, 8]  [21, 14, 11]  [24, 15, 14]  [23, 15, 13]  ... 
|         [99, 91, 84]  [49, 45, 37]   [15, 12, 5]   [20, 13, 8]  [24, 17, 12]  [24, 17, 12]  ... 
|       [111, 103, 99]  [70, 65, 61]  [38, 34, 30]  [31, 25, 19]  [36, 29, 23]  [35, 28, 22]  ... 
|      [124, 118, 115]  [96, 91, 88]  [71, 66, 63]  [47, 41, 34]  [49, 42, 34]  [42, 35, 28]  ... 
|      [123, 118, 115]  [99, 94, 91]  [82, 77, 74]  [55, 48, 41]  [52, 45, 37]  [52, 45, 37]  ... 
|                  ...           ...           ...           ...           ...           ...  ... 
|  # ...</code></pre>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">split_labels</span><span class="op">)</span></code></pre></div>
<pre><code>[[1]]
# Rank 2 tensor, shape: (5000, 1), ranknames: image, label
|  # Rank 1 tensor, shape: (1)
|      6 
|  # ...

[[2]]
# Rank 2 tensor, shape: (5000, 1), ranknames: image, label
|  # Rank 1 tensor, shape: (1)
|      6 
|  # ...

[[3]]
# Rank 2 tensor, shape: (40000, 1), ranknames: image, label
|  # Rank 1 tensor, shape: (1)
|      1 
|  # ...</code></pre>
<p>The proportions vector needn’t add to <code>1.0</code> - the sizes are normalized, such that <code>c(1, 1, 2)</code> is equal to <code>c(0.25, 0.25, 0.5)</code>.</p>
<p><code><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list()</a></code> functions as the inverse of <code><a href="reference/bind.html">bind()</a></code>, partitioning tensors into lists of sub-tensors.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">images</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span>image <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>$`image [1, , , ], shape (32, 32, 3)`
# Rank 3 tensor, shape: (32, 32, 3), ranknames: row, col, channel
    [59, 62, 63]  [43, 46, 45]   [50, 48, 43]   [68, 54, 42]   [98, 73, 52]  [119, 91, 63]  ... 
    [16, 20, 20]     [0, 0, 0]     [18, 8, 0]    [51, 27, 8]   [88, 51, 21]  [120, 82, 43]  ... 
    [25, 24, 21]    [16, 7, 0]    [49, 27, 8]   [83, 50, 23]  [110, 72, 41]  [129, 92, 54]  ... 
    [33, 25, 17]   [38, 20, 4]   [87, 54, 25]  [106, 63, 28]  [115, 70, 33]  [117, 74, 35]  ... 
    [50, 32, 21]  [59, 32, 11]  [102, 65, 34]  [127, 79, 39]  [124, 77, 36]  [121, 77, 36]  ... 
    [71, 48, 29]  [84, 53, 24]  [110, 73, 37]  [129, 82, 38]  [136, 88, 45]  [131, 84, 42]  ... 
             ...           ...            ...            ...            ...            ...  ... 

$`image [2, , , ], shape (32, 32, 3)`
# Rank 3 tensor, shape: (32, 32, 3), ranknames: row, col, channel
    [154, 177, 187]  [126, 137, 136]   [105, 104, 95]   [102, 101, 99]  [125, 131, 139]  [155, 166, 180]  ... 
    [140, 160, 169]  [145, 153, 154]  [125, 125, 118]  [124, 129, 132]  [150, 161, 173]  [152, 164, 175]  ... 
    [140, 155, 164]  [139, 146, 149]  [115, 115, 112]  [147, 153, 159]  [138, 150, 162]  [132, 145, 154]  ... 
    [136, 147, 155]  [137, 142, 146]  [122, 121, 121]  [132, 133, 139]  [151, 157, 167]  [181, 193, 198]  ... 
    [129, 137, 144]  [141, 146, 152]  [136, 139, 142]  [186, 186, 190]  [215, 220, 227]  [202, 216, 223]  ... 
    [136, 144, 149]  [136, 149, 165]  [127, 148, 164]  [153, 172, 181]  [138, 160, 173]  [120, 141, 161]  ... 
                ...              ...              ...              ...              ...              ...  ... 

$`image [3, , , ], shape (32, 32, 3)`
# Rank 3 tensor, shape: (32, 32, 3), ranknames: row, col, channel
    [255, 255, 255]  [253, 253, 253]  [253, 253, 253]  [253, 253, 253]  [253, 253, 253]  [253, 253, 253]  ... 
    [255, 255, 255]  [255, 255, 255]  [255, 255, 255]  [255, 255, 255]  [255, 255, 255]  [255, 255, 255]  ... 
    [255, 255, 255]  [254, 254, 254]  [254, 254, 254]  [254, 254, 254]  [254, 254, 254]  [254, 254, 254]  ... 
    [255, 255, 255]  [255, 255, 255]  [255, 255, 255]  [255, 255, 255]  [255, 255, 255]  [255, 255, 255]  ... 
    [255, 255, 255]  [255, 255, 255]  [255, 255, 255]  [255, 255, 255]  [255, 255, 255]  [255, 255, 255]  ... 
    [255, 255, 255]  [255, 255, 255]  [255, 255, 255]  [255, 255, 255]  [255, 255, 255]  [255, 255, 255]  ... 
                ...              ...              ...              ...              ...              ...  ... </code></pre>
<p>Note that the result is a named list with entries describing their contents. It’s possible to split at ranks lower than the first; in this case all of the sub-tensors at that level become list elements. (This function can take while if the resulting list is very large, which is quite possible with large tensors.)</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">images</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span>image <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="reference/permute.html">permute</a></span><span class="op">(</span><span class="va">image</span>, <span class="va">channel</span>, <span class="va">row</span>, <span class="va">col</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span>rank <span class="op">=</span> <span class="va">channel</span><span class="op">)</span></code></pre></div>
<pre><code>$`channel [1, 1, , ], shape (32, 32)`
# Rank 2 tensor, shape: (32, 32), ranknames: row, col
     59   43   50   68   98  119  ... 
     16    0   18   51   88  120  ... 
     25   16   49   83  110  129  ... 
     33   38   87  106  115  117  ... 
     50   59  102  127  124  121  ... 
     71   84  110  129  136  131  ... 
    ...  ...  ...  ...  ...  ...  ... 

$`channel [1, 2, , ], shape (32, 32)`
# Rank 2 tensor, shape: (32, 32), ranknames: row, col
     62   46   48   54   73   91  ... 
     20    0    8   27   51   82  ... 
     24    7   27   50   72   92  ... 
     25   20   54   63   70   74  ... 
     32   32   65   79   77   77  ... 
     48   53   73   82   88   84  ... 
    ...  ...  ...  ...  ...  ...  ... 

$`channel [1, 3, , ], shape (32, 32)`
# Rank 2 tensor, shape: (32, 32), ranknames: row, col
     63   45   43   42   52   63  ... 
     20    0    0    8   21   43  ... 
     21    0    8   23   41   54  ... 
     17    4   25   28   33   35  ... 
     21   11   34   39   36   36  ... 
     29   24   37   38   45   42  ... 
    ...  ...  ...  ...  ...  ...  ... 

$`channel [2, 1, , ], shape (32, 32)`
# Rank 2 tensor, shape: (32, 32), ranknames: row, col
    154  126  105  102  125  155  ... 
    140  145  125  124  150  152  ... 
    140  139  115  147  138  132  ... 
    136  137  122  132  151  181  ... 
    129  141  136  186  215  202  ... 
    136  136  127  153  138  120  ... 
    ...  ...  ...  ...  ...  ...  ... 
(output truncated)</code></pre>
<p>If <code>flatten = FALSE</code>, a nested list is returned (compatible with the marvelous <a href="https://cran.r-project.org/web/packages/data.tree/vignettes/data.tree.html" class="external-link"><code>data.tree</code></a> package).</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">images</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span>image <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="reference/permute.html">permute</a></span><span class="op">(</span><span class="va">image</span>, <span class="va">channel</span>, <span class="va">row</span>, <span class="va">col</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span>rank <span class="op">=</span> <span class="va">channel</span>, flatten <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span>give.attr <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<pre><code>List of 3
 $ image [1, , , ], shape (3, 32, 32):List of 3
  ..$ channel [1, 1, , ], shape (32, 32): int [1:32, 1:32] 59 16 25 33 50 71 97 115 137 154 ...
  ..$ channel [1, 2, , ], shape (32, 32): int [1:32, 1:32] 62 20 24 25 32 48 69 82 100 120 ...
  ..$ channel [1, 3, , ], shape (32, 32): int [1:32, 1:32] 63 20 21 17 21 29 40 49 68 89 ...
 $ image [2, , , ], shape (3, 32, 32):List of 3
  ..$ channel [2, 1, , ], shape (32, 32): int [1:32, 1:32] 154 140 140 136 129 136 146 162 127 71 ...
  ..$ channel [2, 2, , ], shape (32, 32): int [1:32, 1:32] 177 160 155 147 137 144 154 172 137 75 ...
  ..$ channel [2, 3, , ], shape (32, 32): int [1:32, 1:32] 187 169 164 155 144 149 172 192 138 69 ...
 $ image [3, , , ], shape (3, 32, 32):List of 3
  ..$ channel [3, 1, , ], shape (32, 32): int [1:32, 1:32] 255 255 255 255 255 255 255 255 255 255 ...
  ..$ channel [3, 2, , ], shape (32, 32): int [1:32, 1:32] 255 255 255 255 255 255 255 255 255 255 ...
  ..$ channel [3, 3, , ], shape (32, 32): int [1:32, 1:32] 255 255 255 255 255 255 255 255 255 255 ...</code></pre>
<p>As a reminder with all this list-of-tensors making, <code><a href="reference/bind.html">bind()</a></code> and <code><a href="https://rdrr.io/r/base/c.html" class="external-link">c()</a></code> can each take a list of tensors of the appropriate shape as opposed to one-per-parameter.</p>
</div>
<div id="shuffle-and-tt_apply" class="section level4">
<h4 class="hasAnchor">
<a href="#shuffle-and-tt_apply" class="anchor" aria-hidden="true"></a><code>shuffle()</code> and <code>tt_apply()</code>
</h4>
<p>The <code><a href="reference/shuffle.html">shuffle()</a></code> function shuffles the elements along the first rank. Only the first rank is supported, as lower ranks would break the ‘set-of-sets’ intuition that tidytensor relies on; for example, in a channels-last configurition, shuffling the channels would shuffle them identically for all images in the dataset. This function accepts an optional <code>seed</code> argument to pass to <code><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed()</a></code> for repeatable randomness, again handy for generating training/testing splits.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># shuffle then partition</span>
<span class="va">train_test_images</span> <span class="op">&lt;-</span> <span class="va">images</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="reference/shuffle.html">shuffle</a></span><span class="op">(</span>seed <span class="op">=</span> <span class="fl">42</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="reference/partition.html">partition</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.8</span><span class="op">)</span><span class="op">)</span>
  
<span class="co"># shuffle similarly then partition</span>
<span class="va">train_test_labels</span> <span class="op">&lt;-</span> <span class="va">labels</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="reference/shuffle.html">shuffle</a></span><span class="op">(</span>seed <span class="op">=</span> <span class="fl">42</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="reference/partition.html">partition</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.8</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="tt_apply" class="section level4">
<h4 class="hasAnchor">
<a href="#tt_apply" class="anchor" aria-hidden="true"></a><code>tt_apply()</code>
</h4>
<p>Finally we have <code><a href="reference/tt_apply.html">tt_apply()</a></code>, tidytensor’s answer to base-R <code><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply()</a></code>, another area of not-greatness for arrays in R. While <code><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply()</a></code> allows applying over arbitrary ranks with the <code>MARGIN</code> parameter, it not only removes metadata, it <em>deconstructs</em> each call’s return value into a vector, before <em>prepending</em> it to the remaining ranks. If <code>t</code> has shape <code>(500, 3, 26, 26)</code> and <code>normalize</code> is a function that returns an array of the same shape as it’s input, <code>apply(t, MARGIN = c(1, 2), normalize)</code> doesn’t return a tensor of the same shape as <code>t</code>, but rather shape <code>c(26 * 26, 500, 3)</code>. Blech. <code><a href="reference/tt_apply.html">tt_apply()</a></code> uses <code><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply()</a></code> under the hood, but puts all the pieces back together nicely (and is rankname-aware for both function inputs and outputs).</p>
<p>However, <code><a href="reference/tt_apply.html">tt_apply()</a></code> is limited compared to <code><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply()</a></code> in one respect, it only applies over the “top” N ranks, to stick with the sets-of-sets metaphor. If <code>t</code> has ranknames <code>c("image", "channel", "row", "col")</code>, we can <code><a href="reference/tt_apply.html">tt_apply()</a></code> over every image, or every channel (within each image), or every row (within each channel within each image), and so on. Should a different grouping be desired, <code><a href="reference/permute.html">permute()</a></code> can help.</p>
<p>Here’s a <code><a href="https://keras.rstudio.com/reference/normalize.html" class="external-link">normalize()</a></code> function that respects metadata of input tidytensors (most R functions do, <code>[]</code>, <code><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply()</a></code>, and <code><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale()</a></code> are notable exceptions).</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># scales to [0, 1]</span>
<span class="va">normalize</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">t</span> <span class="op">&lt;-</span> <span class="va">t</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span>
  <span class="va">t</span> <span class="op">&lt;-</span> <span class="va">t</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>For pre-processing, rather than scale the entire dataset to a [0,1] range, perhaps we’d like to do so for each channel of each image, maximizing the dynamic range utilized (but perhaps not actually useful for model training!).</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">images_normalized</span> <span class="op">&lt;-</span> <span class="va">images</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="reference/permute.html">permute</a></span><span class="op">(</span><span class="va">image</span>, <span class="va">channel</span>, <span class="va">row</span>, <span class="va">col</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>   <span class="co"># permute to channels-first</span>
  <span class="fu"><a href="reference/tt_apply.html">tt_apply</a></span><span class="op">(</span><span class="va">channel</span>, <span class="va">normalize</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>        <span class="co"># normalize each (row, col) tensor</span>
  <span class="fu"><a href="reference/permute.html">permute</a></span><span class="op">(</span><span class="va">image</span>, <span class="va">row</span>, <span class="va">col</span>, <span class="va">channel</span><span class="op">)</span>       <span class="co"># permute back if we want</span></code></pre></div>
<p>Notice that here we’ve organized the data channel-first so we can do our per-image, per-channel normalization, then permuted back to the original. Even though <code><a href="reference/tt_apply.html">tt_apply()</a></code> is built on base-R <code><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply()</a></code>, applying can take some time, as a function call is being executed for each entry asked for and there can be <em>quite</em> a few in a large tensor.</p>
<p>The function call results needn’t match their input shape: <code><a href="reference/tt_apply.html">tt_apply()</a></code> just needs returned result to be tensors (vectors, matrices, arrays, or tidytensors) all of the same shape. The featuremap example above was difficult to visualize due to the range of map values; we can get an alternative look by scaling to a zero mean, one variance per featuremap. (Or perhaps we should build a model with batch-normalization!)</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">images</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://keras.rstudio.com/reference/dataset_cifar10.html" class="external-link">dataset_cifar10</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">train</span><span class="op">$</span><span class="va">x</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="reference/tt.html">tt</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="reference/set_ranknames.html">set_ranknames</a></span><span class="op">(</span><span class="va">image</span>, <span class="va">row</span>, <span class="va">col</span>, <span class="va">channel</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="reference/set_dimnames_for_rank.html">set_dimnames_for_rank</a></span><span class="op">(</span><span class="va">channel</span>, <span class="va">R</span>, <span class="va">G</span>, <span class="va">B</span><span class="op">)</span>
  
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>   <span class="co"># for filter()</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
  
<span class="va">images</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span>image <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu">compute_featuremaps</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="reference/tt.html">tt</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="reference/set_ranknames.html">set_ranknames</a></span><span class="op">(</span><span class="va">image</span>, <span class="va">row</span>, <span class="va">col</span>, <span class="va">featuremap</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="reference/permute.html">permute</a></span><span class="op">(</span><span class="va">image</span>, <span class="va">featuremap</span>, <span class="va">row</span>, <span class="va">col</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="reference/tt_apply.html">tt_apply</a></span><span class="op">(</span><span class="va">featuremap</span>, <span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="op">{</span>
    <span class="op">(</span><span class="va">t</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span>
  <span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">featuremap</span> <span class="op">&lt;=</span> <span class="fl">6</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">col</span>, y <span class="op">=</span> <span class="va">row</span>, fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">image</span> <span class="op">~</span> <span class="va">featuremap</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_reverse</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient2</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="docs/images/featuremaps_scaled.png" width="750"></p>
</div>
</div>
<div id="future-work" class="section level3">
<h3 class="hasAnchor">
<a href="#future-work" class="anchor" aria-hidden="true"></a>Future Work</h3>
<p>Aside from the adjustments I’d like to make to the base functionality (particularly in supporting a tidytensor-aware <code>[&lt;-</code>), I think additional functions for ‘tensorifying’ common data types would be beneficial. For example, this package originally included functionality to produce tensor-encoded versions of <a href="https://en.wikipedia.org/wiki/FASTA_format" class="external-link">fasta files</a> commonly used in bioinformations applications. Because these require dependencies (on e.g. <code>Rsamtools</code> and <code>GenomicRanges</code>) and field-specific nature, I’ve pulled those out and hope to eventually make a secondary companion package for such formats.</p>
</div>

  </div>

  <div class="col-md-3 d-none d-md-block" id="pkgdown-sidebar">
      <div class="sticky-top">
        <div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="http://shawntoneil.com">Shawn T. O'Neil</a> <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0001-6220-7080" target="orcid.widget" aria-label="ORCID"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://zenodo.org/badge/latestdoi/160564655" class="external-link"><img src="https://zenodo.org/badge/160564655.svg" alt="DOI"></a></li>
<li><a href="https://github.com/oneilsh/tidytensor/actions" class="external-link"><img src="https://github.com/oneilsh/tidytensor/workflows/R-CMD-check/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://codecov.io/gh/oneilsh/tidytensor" class="external-link"><img src="https://codecov.io/gh/oneilsh/tidytensor/branch/master/graph/badge.svg?token=GWMT57CGDK" alt="codecov"></a></li>
</ul>
</div>

      </div>
  </div>
</div>


      <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="http://shawntoneil.com" class="external-link">Shawn T. O’Neil</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 1.6.1.9001.</p>
</div>

      </footer>
</div>

  

  

  </body>
</html>
